<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- Points Fragment -->
    <div th:fragment="points(weeklySanction, child, rules)" th:id="'points-' + ${child.id}">
        <!-- Points summary -->
        <div class="flex items-center justify-between mb-2">
            <h3 class="text-base font-medium text-gray-700 dark:text-gray-300" th:text="#{sanctions.current.points}">Current Points</h3>
            <span class="text-lg font-bold" 
                  th:classappend="${weeklySanction != null ? (weeklySanction.currentPoints >= 70 ? 'text-green-600 dark:text-green-400' : 
                    (weeklySanction.currentPoints >= 40 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400')) : 'text-gray-600 dark:text-gray-400'}"
                  th:text="${weeklySanction != null ? weeklySanction.currentPoints : '—'}">
                100
            </span>
        </div>
        
        <!-- Progress bar -->
        <div class="w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div th:if="${weeklySanction != null}"
                 th:style="'width: ' + ${weeklySanction.currentPoints} + '%'"
                 th:class="${weeklySanction.currentPoints >= 70 ? 'bg-green-500' : 
                            (weeklySanction.currentPoints >= 40 ? 'bg-yellow-500' : 'bg-red-500')}"
                 class="h-full transition-all duration-500">
            </div>
        </div>
        
        <!-- Points info -->
        <div class="mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
            <span th:text="#{sanctions.start.week}">Start of week</span>
            <span th:text="${weeklySanction != null ? weeklySanction.initialPoints : '—'} + ' ' + #{sanctions.points}">100 points</span>
        </div>
        
        <!-- Manual points adjustment -->
        <div class="mt-4 flex flex-wrap gap-2">
            <button th:each="points : ${{-1, -2, -3, -5, -10}}"
                    th:text="${points}"
                    th:attr="hx-put=@{/sanctions/{childId}/points/{points}(childId=${child.id}, points=${points})},
                           hx-target='#points-' + ${child.id},
                           hx-swap='outerHTML'"
                    class="px-3 py-1 text-sm font-medium rounded-full bg-gray-200 dark:bg-gray-700 
                          hover:bg-red-100 dark:hover:bg-red-900 text-gray-700 dark:text-gray-300
                          hover:text-red-700 dark:hover:text-red-300 transition-colors duration-150">
                -1
            </button>
            <button th:each="points : ${{1, 2, 5}}"
                    th:text="'+' + ${points}"
                    th:attr="hx-put=@{/sanctions/{childId}/points/{points}(childId=${child.id}, points=${points})},
                           hx-target='#points-' + ${child.id},
                           hx-swap='outerHTML'"
                    class="px-3 py-1 text-sm font-medium rounded-full bg-gray-200 dark:bg-gray-700 
                          hover:bg-green-100 dark:hover:bg-green-900 text-gray-700 dark:text-gray-300
                          hover:text-green-700 dark:hover:text-green-300 transition-colors duration-150">
                +1
            </button>
        </div>
        
        <!-- Last update information -->
        <div class="mt-3 text-xs text-gray-500 dark:text-gray-400" th:if="${weeklySanction != null && weeklySanction.lastUpdated != null}">
            <span th:text="#{sanctions.last.updated}">Last updated:</span>
            <span th:text="${#temporals.format(weeklySanction.lastUpdated, 'dd MMM, HH:mm')}">Jan 1, 10:30</span>
        </div>
    </div>
</body>
</html> 